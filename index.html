<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Initiative Financial Dashboard</title>
    <!-- Chosen Palette: Custom Theme (Blue, Mint, Purple, Yellow) -->
    <!-- Application Structure Plan: A single-page dashboard with a master 3-way toggle (Capital, Total $, Hours) at the top. This toggle controls the entire dashboard's context. A new "Monthly Budget" tab has been added to provide a detailed, interactive cash flow forecast for the CFO. The other tabs ("Dashboard", "Use Case Details") remain. This structure now answers "What is the total picture?" (Dashboard) and "What is the *cash* I need *when*?" (Monthly Budget). -->
    <!-- Visualization & Content Choices:
        - Master Toggle: Buttons to switch 'activeView' state (Capital, Total $, Hours). This is the core interaction.
        - KPI Cards: Dynamic text fields showing high-level totals based on 'activeView'.
        - Waterfall Charts (Chart.js): Show 'Investment' vs 'ROI' flow. Dynamically updates.
        - Timeline Chart (Chart.js): Shows cumulative cost vs. benefit. Dynamically updates.
        - New "Monthly Budget" Tab:
            - KPI Cards: "2025 Budget Need" and "2026 Budget Need".
            - Checkboxes: To toggle "Optional" projects on/off, which updates the KPIs.
            - HTML Table: A detailed 14-month cash flow forecast (capital only) based on Gantt chart timelines and specific sandbox scaling rules.
            - Added "2025 Total" and "2026 Total" subtotal columns to the budget table.
            - Added tooltips (via `title` attribute) to each cell in the budget table to show the calculation.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'theme-blue': '#0053a1',
                        'theme-mint': '#36A593', // User's new color
                        'theme-purple': '#663399',
                        'theme-yellow': '#f1dd39',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <div class="container mx-auto p-4 md:p-8">

        <header class="mb-6">
            <h1 class="text-3xl font-bold text-theme-blue">AI Initiatives: Financial & Resource Dashboard</h1>
            <p class="text-lg text-gray-600">Executive Summary & Financial Breakdown</p>
        </header>

        <!-- Master View Toggle -->
        <div id="master-toggle-container" class="mb-6 p-4 bg-white rounded-lg shadow-md">
            <h3 class="text-lg font-semibold mb-3 text-gray-700">Select Dashboard View:</h3>
            <div class="flex flex-wrap gap-2">
                <button id="viewToggleCapital" class="view-toggle bg-theme-blue text-white py-2 px-4 rounded-lg shadow font-medium">
                    Capital Investment (Cash)
                </button>
                <button id="viewToggleTotal" class="view-toggle bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium">
                    Total Investment (All-In $)
                </button>
                <button id="viewToggleHours" class="view-toggle bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium">
                    Resource Effort (Hours)
                </button>
            </div>
        </div>

        <!-- Main KPI Cards (Contextual) -->
        <div id="kpi-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-sm font-medium text-gray-500 uppercase" id="kpiTotalInvestmentLabel">Total Investment</h2>
                <p class="text-3xl font-bold text-theme-purple" id="kpiTotalInvestment">...</p>
                <p class="text-sm text-gray-500" id="kpiTotalInvestmentSub">Max Capital Spend</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-sm font-medium text-gray-500 uppercase">Expected Annual ROI</h2>
                <p class="text-3xl font-bold text-theme-mint" id="kpiTotalROI">$15.0M - $26.0M</p>
                <p class="text-sm text-gray-500">From 4 key initiatives</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-sm font-medium text-gray-500 uppercase">Implementation Timeline</h2>
                <p class="text-3xl font-bold text-gray-800">5-6 Months</p>
                <p class="text-sm text-gray-500">For Phase 1 delivery</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-sm font-medium text-gray-500 uppercase">Benefits Realization</h2>
                <p class="text-3xl font-bold text-gray-800">&lt; 6 Months</p>
                <p class="text-sm text-gray-500">Payback period</p>
            </div>
        </div>

        <!-- Main Tab Navigation -->
        <div class="mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button data-tab="dashboard" class="dashboard-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-theme-blue border-theme-blue">
                        Financial Dashboard
                    </button>
                    <button data-tab="budget" class="dashboard-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">
                        Monthly Budget
                    </button>
                    <button data-tab="details" class="dashboard-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">
                        Use Case Details
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="dashboard-content">

            <!-- Dashboard Tab -->
            <div id="dashboardView" class="tab-content space-y-6">

                <!-- Waterfall Charts -->
                <div id="waterfallSummary" class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-theme-blue">Financial Summary: Investment vs. Return</h2>
                    <div class="border-b border-gray-200 mb-4">
                        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                            <button data-tab="summaryWaterfall" class="waterfall-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-theme-blue border-theme-blue">
                                Summary Waterfall
                            </button>
                            <button data-tab="itemizedWaterfall" class="waterfall-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">
                                Itemized Waterfall
                            </button>
                        </nav>
                    </div>
                    <div id="summaryWaterfallView" class="waterfall-tab-content">
                        <div class="relative w-full h-80">
                            <canvas id="summaryWaterfallChart"></canvas>
                        </div>
                    </div>
                    <div id="itemizedWaterfallView" class="waterfall-tab-content hidden">
                        <div class="relative w-full h-96">
                            <canvas id="itemizedWaterfallChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- The Breakeven Story (Timeline) -->
                <div id="timeline" class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-theme-blue">The Breakeven Story: Cost vs. Benefit Over Time</h2>
                    <div class="relative w-full h-64 md:h-80">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
                
                <!-- Total Investment Breakdown -->
                <div id="resourceInvestment" class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-theme-blue" id="totalInvestmentTitle">Total Investment Breakdown</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 text-center">Investment Mix (by Dollars)</h3>
                            <div class="relative w-full h-80">
                                <canvas id="totalInvestmentMixChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 text-center">Resource Allocation (by Hours)</h3>
                            <div class="relative w-full h-80">
                                <canvas id="resourceAllocationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Resource-Only View (Hidden by default) -->
                <div id="resourceAllocation" class="hidden bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-theme-blue">Resource Allocation (Total Hours)</h2>
                    <div class="relative w-full h-96">
                        <canvas id="resourceAllocationChartHours"></canvas>
                    </div>
                </div>

                <!-- Portfolio Mix -->
                <div id="portfolioMix" class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-theme-blue">Portfolio Mix: Investment vs. Return</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 text-center">Investment by Category</h3>
                            <div class="relative w-full h-80">
                                <canvas id="investmentCategoryChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 text-center">ROI by Category</h3>
                            <div class="relative w-full h-80">
                                <canvas id="roiCategoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Efficiency -->
                <div id="efficiency" class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-theme-blue">Project Efficiency Matrix</h2>
                    <p class="text-sm text-gray-600 mb-4">This chart maps the cost vs. annual return for the 4 direct ROI-generating projects. "AI Foundation" projects are not plotted as their value is enabling these returns.</p>
                    <div class="relative w-full h-96">
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                </div>

                <!-- Investment & ROI Breakdown (Tabs) -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="border-b border-gray-200 mb-4">
                        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                            <button data-tab="investmentView" class="breakdown-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-theme-blue border-theme-blue">
                                Investment Breakdown
                            </button>
                            <button data-tab="roiView" class="breakdown-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">
                                ROI Breakdown
                            </button>
                        </nav>
                    </div>

                    <div id="investmentView" class="breakdown-tab-content grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 text-center">Investment by Category</h3>
                            <div class="relative w-full h-80">
                                <canvas id="investmentDonutChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 text-center">Investment by Use Case</h3>
                            <div class="relative w-full h-80">
                                <canvas id="investmentBarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div id="roiView" class="breakdown-tab-content hidden">
                        <h3 class="text-lg font-semibold text-gray-700 text-center">Min. Annual ROI by Use Case</h3>
                        <div class="relative w-full h-96">
                            <canvas id="roiBarChart"></canvas>
                        </div>
                    </div>
                </div>

            </div>

            <!-- New Monthly Budget Tab -->
            <div id="budgetView" class="tab-content hidden space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold mb-4 text-theme-blue">Monthly Capital Budget Forecast</h2>
                    <p class="text-gray-600 mb-6">This forecast models the monthly *capital (cash)* needed based on the Gantt chart timeline and CFO priorities. Uncheck "Optional" projects to see the immediate budget impact.</p>
                
                    <!-- Budget KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                            <h2 class="text-sm font-medium text-gray-500 uppercase">2025 Budget Need (Nov-Dec)</h2>
                            <p class="text-3xl font-bold text-theme-purple" id="budget2025">...</p>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                            <h2 class="text-sm font-medium text-gray-500 uppercase">2026 Budget Need</h2>
                            <p class="text-3xl font-bold text-theme-purple" id="budget2026">...</p>
                        </div>
                    </div>

                    <!-- Project Toggles -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <!-- THIS IS THE FIX -->
                            <h3 class="text-lg font-semibold text-theme-blue mb-2">Foundational</h3>
                            <div class="space-y-2">
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-blue rounded" data-project="AI Governance Council" checked disabled>
                                    <span class="ml-2">AI Governance Council</span>
                                </label>
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-blue rounded" data-project="AI Literacy & Enablement" checked disabled>
                                    <span class="ml-2">AI Literacy & Enablement</span>
                                </label>
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-blue rounded" data-project="Tech & Data Preparation" checked disabled>
                                    <span class="ml-2">Tech & Data Preparation</span>
                                </label>
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-blue rounded" data-project="AI Development Tools" checked disabled>
                                    <span class="ml-2">AI Development Tools</span>
                                </label>
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-blue rounded" data-project="Marketing & Sales Enablement" checked disabled>
                                    <span class="ml-2">Marketing & Sales Enablement</span>
                                </label>
                                <label class="flex items-center text-gray-700">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-blue rounded" data-project="Strategic AI Advisory Services" checked disabled>
                                    <span class="ml-2">Strategic AI Advisory Services</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <!-- THIS IS THE FIX -->
                            <h3 class="text-lg font-semibold text-theme-mint mb-2">Quick Wins</h3>
                            <div class="space-y-2">
                                <label class="flex items-center text-gray-700 cursor-pointer">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-mint rounded" data-project="Proposal & SOW Automation" checked>
                                    <span class="ml-2">Proposal & SOW Automation</span>
                                </label>
                                <label class="flex items-center text-gray-700 cursor-pointer">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-mint rounded" data-project="AI Meeting Assistant" checked>
                                    <span class="ml-2">AI Meeting Assistant</span>
                                </label>
                                <label class="flex items-center text-gray-700 cursor-pointer">
                                    <input type="checkbox" class="budget-toggle h-4 w-4 text-theme-mint rounded" data-project="Large Document Interrogation" checked>
                                    <span class="ml-2">Large Document Interrogation</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Budget Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Nov '25</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Dec '25</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider font-bold">2025 Total</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Jan '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Feb '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Mar '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Apr '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">May '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Jun '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Jul '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Aug '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Sep '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Oct '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Nov '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Dec '26</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider font-bold">2026 Total</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider font-bold">Grand Total</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="budgetTableBody">
                                <!-- JS will populate this -->
                            </tbody>
                            <tfoot class="bg-gray-100" id="budgetTableFooter">
                                <!-- JS will populate this -->
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Use Case Details Tab -->
            <div id="detailsView" class="tab-content hidden space-y-4">
                <!-- Content will be dynamically generated here -->
            </div>

        </div> <!-- /end #dashboard-content -->
    </div> <!-- /end .container -->

    <script>
        // --- DATA ---
        // This is the single source of truth, collated from all provided PDFs.
        const fullData = {
            projects: [
                {
                    id: "AI Governance Council",
                    name: "AI Governance Council",
                    category: "AI Foundation",
                    capitalCostMin: 0,
                    capitalCostMax: 0,
                    resourceCost: 644040,
                    resourceHours: 1636,
                    ongoingCost: 1196 * 300, // Estimate from summary
                    description: "Establishes guidelines, reviews projects, and manages AI-related risks.",
                    timeline: "8 weeks",
                    roiMin: 0,
                    roiMax: 0,
                    metrics: ["Time-to-Resolve on AI Risk", "Tool in Compliance Rate"],
                    cfoPriority: "Crucial"
                },
                {
                    id: "AI Literacy & Enablement",
                    name: "AI Literacy & Enablement",
                    category: "AI Foundation",
                    capitalCostMin: 14500 + 108000,
                    capitalCostMax: 14500 + 324000, // 338500
                    resourceCost: 2996100,
                    resourceHours: 8870,
                    ongoingCost: 40000 + 324000, // Max ongoing
                    description: "Trains leadership and all resources on AI fundamentals and tool usage.",
                    timeline: "6 weeks",
                    roiMin: 0,
                    roiMax: 0,
                    metrics: ["AI Literacy Rate", "Task Automation Adoption", "Talent Retention"],
                    cfoPriority: "Crucial"
                },
                {
                    id: "Tech & Data Preparation",
                    name: "Tech & Data Preparation",
                    category: "AI Foundation",
                    // This capital cost is the sandbox, which is now handled by the new budget model
                    capitalCostMin: 100000, 
                    capitalCostMax: 500000,
                    resourceCost: 492400,
                    resourceHours: 1360,
                    ongoingCost: 500000, // Max ongoing
                    description: "Prepares data and establishes sandbox environments for AI development.",
                    timeline: "12 weeks",
                    roiMin: 0,
                    roiMax: 0,
                    metrics: ["AI Data Readiness Score", "Time-to-Insight", "Experiment-to-Product Velocity"],
                    cfoPriority: "Crucial"
                },
                {
                    id: "AI Development Tools",
                    name: "AI Development Tools",
                    category: "AI Foundation",
                    capitalCostMin: 48000,
                    capitalCostMax: 48000,
                    resourceCost: 48000,
                    resourceHours: 160,
                    ongoingCost: 48000,
                    description: "Provides developers with tools to build, test, and deploy AI models.",
                    timeline: "12 weeks",
                    roiMin: 0,
                    roiMax: 0,
                    metrics: ["Project Velocity", "Time-to-Delivery"],
                    cfoPriority: "Crucial"
                },
                {
                    id: "Proposal & SOW Automation",
                    name: "Proposal & SOW Automation",
                    category: "Quick Win",
                    capitalCostMin: 1000,
                    capitalCostMax: 1000,
                    resourceCost: 233600,
                    resourceHours: 680,
                    ongoingCost: 12000,
                    description: "Uses AI to automate and accelerate the creation of proposals and SOWs.",
                    timeline: "8 weeks",
                    roiMin: 3400000,
                    roiMax: 3400000,
                    metrics: ["Increase Win Rate", "Higher Deal Value", "70% Proposal Speed"],
                    cfoPriority: "Optional"
                },
                {
                    id: "AI Meeting Assistant",
                    name: "AI Meeting Assistant",
                    category: "Quick Win",
                    capitalCostMin: 72000,
                    capitalCostMax: 72000,
                    resourceCost: 48000,
                    resourceHours: 160,
                    ongoingCost: 72000,
                    description: "Provides transcription, summarization, and action item tracking for meetings.",
                    timeline: "6 weeks",
                    roiMin: 1170000,
                    roiMax: 2340000,
                    metrics: ["Time saved on Meeting Summary", "Increased accountability"],
                    cfoPriority: "Optional"
                },
                {
                    id: "Large Document Interrogation",
                    name: "Large Document Interrogation",
                    category: "Quick Win",
                    capitalCostMin: 50400,
                    capitalCostMax: 50400,
                    resourceCost: 48000, // Estimate from summary: 160hrs * $300
                    resourceHours: 160,
                    ongoingCost: 50400,
                    description: "AI tool to search and synthesize information from large documents.",
                    timeline: "12 weeks",
                    roiMin: 520000,
                    roiMax: 780000,
                    metrics: ["Time-on-Reviewing-Large-Document", "Time-to-Impact"],
                    cfoPriority: "Optional"
                },
                {
                    id: "Marketing & Sales Enablement",
                    name: "Marketing & Sales Enablement",
                    category: "Strategic Value",
                    capitalCostMin: 0,
                    capitalCostMax: 0,
                    resourceCost: 632000,
                    resourceHours: 1760,
                    ongoingCost: 800 * 300, // Estimate from summary
                    description: "Develops AI-powered GTM strategies and sales collateral.",
                    timeline: "N/A",
                    roiMin: 1500000,
                    roiMax: 2500000,
                    metrics: ["AI GTM Readiness", "Revenue Generated", "New Logos"],
                    cfoPriority: "Crucial"
                },
                {
                    id: "Strategic AI Advisory Services",
                    name: "Strategic AI Advisory Services",
                    category: "Strategic Value",
                    capitalCostMin: 0,
                    capitalCostMax: 0,
                    resourceCost: 84000,
                    resourceHours: 280,
                    ongoingCost: 0,
                    description: "New client-facing service offering for strategic AI advisory.",
                    timeline: "N/A",
                    roiMin: 1800000,
                    roiMax: 1800000,
                    metrics: ["Number of AI Strategy Engagements", "Revenue Generated"],
                    cfoPriority: "Crucial"
                }
            ],
            summary: {
                totalResourceCost: 5226140, // Sum of all 9 project resourceCosts
                totalResourceHours: 14906, // Sum of all resourceHours
                totalMinCapital: 393900,  // Sum of all capitalCostMin
                totalMaxCapital: 1010900, // Sum of all capitalCostMax
                totalOngoingCost: 1246400, // Sum of all ongoingCost
                totalMinROI: 8390000,     // Sum of ROI-generating projects' min ROI
                totalMaxROI: 10820000,    // Sum of ROI-generating projects' max ROI
                summaryMinROI: 15000000,
                summaryMaxROI: 26000000,
            },
            // This new object drives the budget table
            capitalBudget: {
                // Gantt: Nov '25 - Jan '26. No capital costs.
                "AI Governance Council": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                // Gantt: Nov '25 - Feb '26. 
                // One-time $14.5k / 4mo = $3625/mo for Nov, Dec, Jan, Feb.
                // Annual $324k / 12mo = $27,000/mo. Starts Nov.
                "AI Literacy & Enablement": [30625, 30625, 30625, 30625, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000, 27000],
                // Gantt: Jan '26 - Mar '26.
                // Sandbox Only (no separate hardware cost): 5 env @ $2k/mo for 2025. 10 env for Jan-May '26. 20 env for Jun-Dec '26.
                "Tech & Data Preparation": [10000, 10000, 20000, 20000, 20000, 20000, 20000, 40000, 40000, 40000, 40000, 40000, 40000, 40000],
                // Gantt: Feb '26 - Mar '26.
                // Annual $48k / 12mo = $4,000/mo. Starts Feb '26.
                "AI Development Tools": [0, 0, 0, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000, 4000],
                // THIS IS THE FIX: Removed $500 one-time cost.
                "Proposal & SOW Automation": [0, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000],
                // Gantt: Jan '26 - Feb '26.
                // Annual $72k / 12mo = $6,000/mo. Starts Jan '26.
                "AI Meeting Assistant": [0, 0, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000, 6000],
                // Gantt: Mar '26.
                // Annual $50.4k / 12mo = $4,200/mo. Starts Mar '26.
                "Large Document Interrogation": [0, 0, 0, 0, 4200, 4200, 4200, 4200, 4200, 4200, 4200, 4200, 4200, 4200],
                // Gantt: Dec '25 - Mar '26. No capital costs.
                "Marketing & Sales Enablement": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                // Gantt: Jan '26 - Mar '26. No capital costs.
                "Strategic AI Advisory Services": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            },
            // THIS IS THE FIX: Updated tooltip text
            capitalBudgetTooltips: {
                "AI Governance Council": [
                    "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0"
                ],
                "AI Literacy & Enablement": [
                    "$27,000 (Monthly Tool License) + $3,625 (Phased Training Fee)", "$27,000 (Monthly Tool License) + $3,625 (Phased Training Fee)", "$27,000 (Monthly Tool License) + $3,625 (Phased Training Fee)", "$27,000 (Monthly Tool License) + $3,625 (Phased Training Fee)",
                    "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)",
                    "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)", "$27,000 (Monthly Tool License)"
                ],
                "Tech & Data Preparation": [
                    "5 Sandbox Environments @ $2,000/mo", "5 Sandbox Environments @ $2,000/mo",
                    "10 Sandbox Environments @ $2,000/mo", "10 Sandbox Environments @ $2,000/mo", "10 Sandbox Environments @ $2,000/mo", "10 Sandbox Environments @ $2,000/mo", "10 Sandbox Environments @ $2,000/mo",
                    "20 Sandbox Environments @ $2,000/mo", "20 Sandbox Environments @ $2,000/mo", "20 Sandbox Environments @ $2,000/mo", "20 Sandbox Environments @ $2,000/mo", "20 Sandbox Environments @ $2,000/mo", "20 Sandbox Environments @ $2,000/mo", "20 Sandbox Environments @ $2,000/mo"
                ],
                "AI Development Tools": [
                    "$0", "$0", "$0", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)",
                    "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)", "$4,000 (Monthly Dev Tool License)"
                ],
                "Proposal & SOW Automation": [
                    "$0", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)",
                    "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)",
                    "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)", "$1,000 (Monthly Hosting)"
                ],
                "AI Meeting Assistant": [
                    "$0", "$0", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)",
                    "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)", "$6,000 (Monthly Meeting Tool License)"
                ],
                "Large Document Interrogation": [
                    "$0", "$0", "$0", "$0", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)",
                    "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)", "$4,200 (Monthly Doc Tool License)"
                ],
                "Marketing & Sales Enablement": [
                    "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0"
                ],
                "Strategic AI Advisory Services": [
                    "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0", "$0"
                ]
            }
        };
        
        fullData.summary.totalMinInvestment = fullData.summary.totalMinCapital + fullData.summary.totalResourceCost;
        fullData.summary.totalMaxInvestment = fullData.summary.totalMaxCapital + fullData.summary.totalResourceCost;


        // --- STATE ---
        const chartInstances = {};
        let activeView = 'capital'; // 'capital', 'total', 'hours'
        let activeBreakdownTab = 'investmentView'; 
        let activeBudgetTab = 'dashboard';
        const themeColors = {
            blue: '#0053a1',
            mint: '#36A593', // User's new color
            purple: '#663399',
            yellow: '#f1dd39',
        };

        // --- CORE LOGIC ---

        document.addEventListener('DOMContentLoaded', () => {
            setupToggles();
            setupTabs();
            updateDashboard();
            initBudgetTab(); // Initialize the new budget tab logic
        });
        
        function setupToggles() {
            const toggles = [
                { id: 'viewToggleCapital', view: 'capital' },
                { id: 'viewToggleTotal', view: 'total' },
                { id: 'viewToggleHours', view: 'hours' },
            ];
            
            toggles.forEach(toggle => {
                document.getElementById(toggle.id).addEventListener('click', () => {
                    activeView = toggle.view;
                    updateDashboard();
                });
            });
        }

        function setupTabs() {
            const tabs = document.querySelectorAll('.dashboard-tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            const masterToggleContainer = document.getElementById('master-toggle-container');
            const kpiCardsContainer = document.getElementById('kpi-cards');
            const toggles = document.querySelectorAll('.view-toggle');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => {
                        t.classList.remove('text-theme-blue', 'border-theme-blue');
                        t.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    tab.classList.add('text-theme-blue', 'border-theme-blue');
                    tab.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    
                    const tabName = tab.getAttribute('data-tab');
                    activeBudgetTab = tabName;
                    
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${tabName}View`).classList.remove('hidden');
                    
                    // THIS IS THE FIX: Show/hide/disable master toggle and kpi cards
                    masterToggleContainer.classList.remove('hidden');
                    kpiCardsContainer.classList.remove('hidden');

                    if (tabName === 'budget') {
                        // On Budget tab: Disable toggles and force Capital view
                        toggles.forEach(toggle => {
                            toggle.disabled = true;
                            toggle.classList.add('opacity-50', 'cursor-not-allowed');
                        });
                        updateToggleStyles('capital'); // Force visual state to Capital
                        initKpiCards(getChartData('capital')); // Force KPI cards to show Capital data
                    } else if (tabName === 'details') {
                         // On Details tab: Enable toggles and restore state
                        toggles.forEach(toggle => {
                            toggle.disabled = false;
                            toggle.classList.remove('opacity-50', 'cursor-not-allowed');
                        });
                        updateToggleStyles(activeView); // Restore visual state
                        initKpiCards(getChartData(activeView)); // Restore KPI cards
                        populateDetailsTab(); // Re-run this to update details
                    } else {
                         // On Dashboard tab: Enable toggles and restore state
                        toggles.forEach(toggle => {
                            toggle.disabled = false;
                            toggle.classList.remove('opacity-50', 'cursor-not-allowed');
                        });
                        updateToggleStyles(activeView); // Restore visual state
                        initKpiCards(getChartData(activeView)); // Restore KPI cards
                    }
                });
            });
            
            const waterfallTabs = document.querySelectorAll('.waterfall-tab');
            const waterfallContents = document.querySelectorAll('.waterfall-tab-content');
            waterfallTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    waterfallTabs.forEach(t => {
                        t.classList.remove('text-theme-blue', 'border-theme-blue');
                        t.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    tab.classList.add('text-theme-blue', 'border-theme-blue');
                    tab.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');

                    const tabName = tab.getAttribute('data-tab');
                    waterfallContents.forEach(c => c.classList.add('hidden'));
                    document.getElementById(`${tabName}View`).classList.remove('hidden');
                });
            });

            const breakdownTabs = document.querySelectorAll('.breakdown-tab');
            const breakdownContents = document.querySelectorAll('.breakdown-tab-content');
            breakdownTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    activeBreakdownTab = tabName; 

                    breakdownTabs.forEach(t => {
                        t.classList.remove('text-theme-blue', 'border-theme-blue');
                        t.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    tab.classList.add('text-theme-blue', 'border-theme-blue');
                    tab.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');

                    breakdownContents.forEach(c => c.classList.add('hidden'));
                    
                    const contentEl = document.getElementById(tabName);
                    if (contentEl) {
                        contentEl.classList.remove('hidden');
                    }
                });
            });
        }

        function updateDashboard() {
            // This function is now ONLY for the master toggles, not tab switches
            updateToggleStyles(activeView);
            destroyAllCharts();
            updateVisibility();
            initAllCharts();
        }

        function updateToggleStyles(forceView) {
            // THIS IS THE FIX: Accepts an optional view to force
            const viewToShow = forceView || activeView;
            
            const toggles = [
                { id: 'viewToggleCapital', view: 'capital' },
                { id: 'viewToggleTotal', view: 'total' },
                { id: 'viewToggleHours', view: 'hours' },
            ];
            
            toggles.forEach(toggle => {
                const button = document.getElementById(toggle.id);
                button.classList.remove('bg-theme-blue', 'text-white', 'bg-gray-200', 'text-gray-700');
                if (toggle.view === viewToShow) {
                    button.classList.add('bg-theme-blue', 'text-white');
                } else {
                    button.classList.add('bg-gray-200', 'text-gray-700');
                }
            });
        }

        function updateVisibility() {
            const financialCharts = ['waterfallSummary', 'timeline', 'portfolioMix', 'efficiency'];
            const hourCharts = ['resourceInvestment', 'resourceAllocation'];
            
            const roiTabButton = document.querySelector('[data-tab="roiView"]');
            const investmentTabButton = document.querySelector('[data-tab="investmentView"]');
            const roiTabContent = document.getElementById('roiView');
            const investmentTabContent = document.getElementById('investmentView');


            if (activeView === 'hours') {
                financialCharts.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.add('hidden');
                });
                hourCharts.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('hidden');
                });
                
                // When switching to 'hours', force the 'Investment' tab to be active
                if (roiTabButton) roiTabButton.classList.add('hidden');
                if (roiTabContent) roiTabContent.classList.add('hidden');
                
                if (investmentTabButton) {
                    investmentTabButton.classList.remove('hidden');
                    investmentTabButton.classList.add('text-theme-blue', 'border-theme-blue');
                    investmentTabButton.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                }
                if (investmentTabContent) investmentTabContent.classList.remove('hidden');
                activeBreakdownTab = 'investmentView'; // Reset active tab


            } else { // 'capital' or 'total'
                financialCharts.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('hidden');
                });
                hourCharts.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.add('hidden');
                });
                
                if (roiTabButton) roiTabButton.classList.remove('hidden');
                
                // Restore the previously selected tab
                if (activeBreakdownTab === 'roiView') {
                    if (roiTabButton) {
                        roiTabButton.classList.add('text-theme-blue', 'border-theme-blue');
                        roiTabButton.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    }
                    if (roiTabContent) roiTabContent.classList.remove('hidden');
                    if (investmentTabButton) {
                        investmentTabButton.classList.remove('text-theme-blue', 'border-theme-blue');
                        investmentTabButton.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    }
                    if (investmentTabContent) investmentTabContent.classList.add('hidden');
                } else {
                    // Default to 'investmentView'
                    if (investmentTabButton) {
                        investmentTabButton.classList.add('text-theme-blue', 'border-theme-blue');
                        investmentTabButton.classList.remove('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    }
                    if (investmentTabContent) investmentTabContent.classList.remove('hidden');
                    if (roiTabButton) {
                        roiTabButton.classList.remove('text-theme-blue', 'border-theme-blue');
                        roiTabButton.classList.add('text-gray-500', 'border-transparent', 'hover:text-gray-700', 'hover:border-gray-300');
                    }
                    if (roiTabContent) roiTabContent.classList.add('hidden');
                }
            }

            const totalInvestmentSection = document.getElementById('resourceInvestment');
            const totalInvestmentTitle = document.getElementById('totalInvestmentTitle');
            if (activeView === 'hours') {
                if (totalInvestmentSection) totalInvestmentSection.classList.add('hidden'); // Hide for hours
            } else {
                if (totalInvestmentSection) totalInvestmentSection.classList.remove('hidden');
                if (totalInvestmentTitle) totalInvestmentTitle.textContent = activeView === 'capital' ? 'Capital vs. Resource Investment' : 'Total Investment Breakdown';
            }
        }

        function destroyAllCharts() {
            Object.values(chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
        }

        function initAllCharts() {
            const data = getChartData();

            initKpiCards(data);
            
            // Financial charts (hide in 'hours' view)
            if (activeView !== 'hours') {
                initWaterfallSummaryChart(data);
                initWaterfallByCaseChart(data);
                initTimelineChart(data);
                initPortfolioMixCharts(data);
                initEfficiencyChart(data);
                initRoiChart(data);
            } else {
                // Call the new function ONLY in hours view
                initResourceHourChart(data);
            }

            // Investment charts (always show, but content changes)
            initInvestmentCharts(data);

            // Details tab
            populateDetailsTab();
        }
        
        // --- DATA HELPERS ---

        function getChartData(forceView) {
            const view = forceView || activeView;
            const data = fullData.summary;
            
            // View 1: Capital Investment
            const capital = {
                investment: {
                    minTotal: data.totalMinCapital,
                    maxTotal: data.totalMaxCapital,
                    ongoing: data.totalOngoingCost,
                    byCategory: {
                        'AI Foundation': 670500, // Sum of capital costs for foundation
                        'Quick Win': 123400,
                        'Strategic Value': 0
                    },
                    byProject: fullData.projects.reduce((acc, p) => {
                        acc[p.name] = p.capitalCostMax;
                        return acc;
                    }, {})
                },
                roi: {
                    minTotal: data.summaryMinROI,
                    maxTotal: data.summaryMaxROI,
                    byCategory: {
                        'Quick Win': 5090000, // Sum of min ROI
                        'Strategic Value': 3300000
                    },
                    byProject: fullData.projects.reduce((acc, p) => {
                        acc[p.name] = p.roiMin;
                        return acc;
                    }, {})
                }
            };

            // View 2: Total Investment (All-In $)
            const total = {
                investment: {
                    minTotal: data.totalMinInvestment,
                    maxTotal: data.totalMaxInvestment,
                    ongoing: data.totalOngoingCost,
                    byCategory: fullData.projects.reduce((acc, p) => {
                        const cost = (p.capitalCostMax + p.resourceCost);
                        if (!acc[p.category]) acc[p.category] = 0;
                        acc[p.category] += cost;
                        return acc;
                    }, {}),
                    byProject: fullData.projects.reduce((acc, p) => {
                        acc[p.name] = p.capitalCostMax + p.resourceCost;
                        return acc;
                    }, {})
                },
                roi: capital.roi // ROI doesn't change
            };

            // View 3: Resource Effort (Hours)
            const hours = {
                investment: {
                    minTotal: data.totalResourceHours,
                    maxTotal: data.totalResourceHours,
                    ongoing: 0, // N/A
                    byCategory: fullData.projects.reduce((acc, p) => {
                        if (!acc[p.category]) acc[p.category] = 0;
                        acc[p.category] += p.resourceHours;
                        return acc;
                    }, {}),
                    byProject: fullData.projects.reduce((acc, p) => {
                        acc[p.name] = p.resourceHours;
                        return acc;
                    }, {})
                },
                roi: { minTotal: 0, maxTotal: 0, byCategory: {}, byProject: {} } // N/A
            };

            if (view === 'capital') return capital;
            if (view === 'total') return total;
            return hours; // view === 'hours'
        }

        function getProjectChartData(project) {
            if (activeView === 'capital') {
                return {
                    investment: project.capitalCostMax,
                    roi: project.roiMin
                };
            }
            if (activeView === 'total') {
                return {
                    investment: project.capitalCostMax + project.resourceCost,
                    roi: project.roiMin
                };
            }
            // activeView === 'hours'
            return {
                investment: project.resourceHours,
                roi: 0 // ROI is not measured in hours
            };
        }

        // --- CHART INIT FUNCTIONS ---

        function initKpiCards(data) {
            const { investment, roi } = data;
            const kpiInvestment = document.getElementById('kpiTotalInvestment');
            const kpiInvestmentLabel = document.getElementById('kpiTotalInvestmentLabel');
            const kpiInvestmentSub = document.getElementById('kpiTotalInvestmentSub');
            const kpiRoi = document.getElementById('kpiTotalROI');

            // THIS IS THE FIX: Determine view from data, not global state
            let currentView = 'capital';
            if (investment.maxTotal === fullData.summary.totalMaxInvestment) {
                currentView = 'total';
            } else if (investment.maxTotal === fullData.summary.totalResourceHours) {
                currentView = 'hours';
            }

            const format = (val) => currentView === 'hours' ? 
                `${val.toLocaleString()} hrs` : 
                `$${(val / 1000000).toFixed(2)}M`;

            kpiInvestment.textContent = format(investment.maxTotal);
            
            if (currentView === 'capital') {
                kpiInvestmentLabel.textContent = 'Total Capital Investment';
                kpiInvestmentSub.textContent = 'Max Capital Spend';
                kpiRoi.textContent = `$${(roi.minTotal / 1000000).toFixed(1)}M - $${(roi.maxTotal / 1000000).toFixed(1)}M`;
                kpiRoi.parentElement.classList.remove('hidden');
            } else if (currentView === 'total') {
                kpiInvestmentLabel.textContent = 'Total All-In Investment';
                kpiInvestmentSub.textContent = `(${(fullData.summary.totalMaxCapital / 1000000).toFixed(2)}M Capital + ${(fullData.summary.totalResourceCost / 1000000).toFixed(2)}M Resources)`;
                kpiRoi.textContent = `$${(roi.minTotal / 1000000).toFixed(1)}M - $${(roi.maxTotal / 1000000).toFixed(1)}M`;
                kpiRoi.parentElement.classList.remove('hidden');
            } else { // hours
                kpiInvestmentLabel.textContent = 'Total Resource Effort';
                kpiInvestmentSub.textContent = 'Initial Build Hours';
                kpiRoi.parentElement.classList.add('hidden');
            }
        }
        
        function initWaterfallSummaryChart(data) {
            const { investment, roi } = data;
            const investmentVal = investment.maxTotal;
            const roiVal = roi.minTotal;
            const net = roiVal - investmentVal;

            const ctx = document.getElementById('summaryWaterfallChart').getContext('2d');
            chartInstances.summaryWaterfall = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Max Investment', 'Min Annual ROI', 'Net Position'],
                    datasets: [{
                        label: 'Financial Flow',
                        data: [
                            [0, investmentVal],
                            [investmentVal, roiVal],
                            [0, net]
                        ],
                        backgroundColor: [
                            themeColors.purple,
                            themeColors.mint,
                            themeColors.yellow
                        ],
                        borderColor: [
                            themeColors.purple,
                            themeColors.mint,
                            themeColors.yellow
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const val = context.raw[1] - context.raw[0];
                                    return `${context.label}: $${(val / 1000000).toFixed(2)}M`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: (val) => `$${val / 1000000}M`
                            },
                            title: {
                                display: true,
                                text: 'Amount (in Millions)'
                            }
                        }
                    }
                }
            });
        }

        function initWaterfallByCaseChart(data) {
            const { investment, roi } = data;
            
            const labels = [
                'AI Foundation', 'Quick Wins', 'Strategic Value', 'Total Investment',
                'Proposal ROI', 'Meeting ROI', 'Doc ROI', 'Mktg ROI', 'Advisory ROI',
                'Total Min. ROI', 'Itemized Net Position'
            ];
            
            const foundation = investment.byCategory['AI Foundation'];
            const quickWin = investment.byCategory['Quick Win'];
            const strategic = investment.byCategory['Strategic Value'];
            const totalInvestment = foundation + quickWin + strategic;

            const pRoi = roi.byProject['Proposal & SOW Automation'];
            const mRoi = roi.byProject['AI Meeting Assistant'];
            const dRoi = roi.byProject['Large Document Interrogation'];
            const sRoi = roi.byProject['Marketing & Sales Enablement'];
            const aRoi = roi.byProject['Strategic AI Advisory Services'];
            const totalRoi = pRoi + mRoi + dRoi + sRoi + aRoi;
            const net = totalRoi - totalInvestment;

            const dataPoints = [
                [0, foundation], [foundation, foundation + quickWin], [foundation + quickWin, totalInvestment], [0, totalInvestment],
                [totalInvestment, totalInvestment + pRoi],
                [totalInvestment + pRoi, totalInvestment + pRoi + mRoi],
                [totalInvestment + pRoi + mRoi, totalInvestment + pRoi + mRoi + dRoi],
                [totalInvestment + pRoi + mRoi + dRoi, totalInvestment + pRoi + mRoi + dRoi + sRoi],
                [totalInvestment + pRoi + mRoi + dRoi + sRoi, totalInvestment + totalRoi],
                [0, totalRoi],
                [0, net]
            ];
            
            const ctx = document.getElementById('itemizedWaterfallChart').getContext('2d');
            chartInstances.itemizedWaterfall = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Financial Flow',
                        data: dataPoints,
                        backgroundColor: [
                            themeColors.purple, themeColors.purple, themeColors.purple, themeColors.purple,
                            themeColors.mint, themeColors.mint, themeColors.mint, themeColors.mint, themeColors.mint,
                            themeColors.mint, themeColors.yellow
                        ],
                        borderColor: 'white',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            ticks: { callback: (val) => `$${val / 1000000}M` },
                            title: { display: true, text: 'Amount (in Millions)' }
                        }
                    }
                }
            });
        }

        function generateTimelineData(investment, ongoing, roi, months = 24) {
            let cumulativeCost = 0;
            let cumulativeRoi = 0;
            const costData = [];
            const roiData = [];
            const labels = [];
            const implementationPeriod = 6;
            const benefitsStartMonth = 6;
            const monthlyInvestment = investment / implementationPeriod;
            const monthlyOngoing = ongoing / 12;
            const monthlyRoi = roi / 12;

            for (let i = 0; i <= months; i++) {
                labels.push(`Month ${i}`);
                if (i <= implementationPeriod) {
                    cumulativeCost += monthlyInvestment;
                }
                if (i > implementationPeriod) {
                    cumulativeCost += monthlyOngoing;
                }
                if (i >= benefitsStartMonth) {
                    cumulativeRoi += monthlyRoi;
                }
                costData.push(cumulativeCost);
                roiData.push(cumulativeRoi);
            }
            return { labels, costData, roiData };
        }

        function initTimelineChart(data) {
            const { investment, roi } = data;
            const timelineData = generateTimelineData(investment.maxTotal, investment.ongoing, roi.minTotal);
            
            const ctx = document.getElementById('timelineChart').getContext('2d');
            chartInstances.timeline = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timelineData.labels,
                    datasets: [
                        {
                            label: 'Cumulative Investment',
                            data: timelineData.costData,
                            borderColor: themeColors.purple,
                            backgroundColor: `${themeColors.purple}33`,
                            fill: true,
                            tension: 0.1
                        },
                        {
                            label: 'Cumulative ROI',
                            data: timelineData.roiData,
                            borderColor: themeColors.mint,
                            backgroundColor: `${themeColors.mint}33`,
                            fill: true,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Cumulative Investment vs. ROI (Payback Period)' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            ticks: { callback: (val) => `$${(val / 1000000).toFixed(1)}M` },
                            title: { display: true, text: 'Amount (in Millions)' }
                        },
                        x: {
                            title: { display: true, text: 'Months' }
                        }
                    }
                }
            });
        }

        function initPortfolioMixCharts() {
            // This section is a bit different, it doesn't use the toggle
            // It *always* shows the breakdown of the "Total" (All-in) cost
            
            // Chart 1: Capital vs. Resource $
            const mixData = {
                labels: ['Capital Investment', 'Resource Cost'],
                datasets: [{
                    data: [fullData.summary.totalMaxCapital, fullData.summary.totalResourceCost],
                    backgroundColor: [themeColors.blue, themeColors.purple],
                }]
            };
            const ctxMix = document.getElementById('totalInvestmentMixChart').getContext('2d');
            chartInstances.totalInvestmentMix = new Chart(ctxMix, {
                type: 'doughnut',
                data: mixData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: $${c.raw.toLocaleString()}` } }
                    }
                }
            });

            // Chart 2: Resource Hours by Category
            const hoursByCategory = getChartData('hours').investment.byCategory;
            const allocationData = {
                labels: Object.keys(hoursByCategory),
                datasets: [{
                    data: Object.values(hoursByCategory),
                    backgroundColor: [themeColors.blue, themeColors.mint, themeColors.purple],
                }]
            };
            const ctxAlloc = document.getElementById('resourceAllocationChart').getContext('2d');
            chartInstances.resourceAllocation = new Chart(ctxAlloc, {
                type: 'doughnut',
                data: allocationData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: ${c.raw.toLocaleString()} hrs` } }
                    }
                }
            });

            // These are the *other* portfolio mix charts
            const { investment, roi } = getChartData();
            
            const investCatData = {
                labels: Object.keys(investment.byCategory),
                datasets: [{
                    data: Object.values(investment.byCategory),
                    backgroundColor: [themeColors.blue, themeColors.mint, themeColors.purple],
                }]
            };
            const ctxInvest = document.getElementById('investmentCategoryChart').getContext('2d');
            chartInstances.investmentCategory = new Chart(ctxInvest, {
                type: 'doughnut',
                data: investCatData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: ${activeView === 'hours' ? c.raw.toLocaleString() + ' hrs' : '$' + c.raw.toLocaleString()}` } }
                    }
                }
            });

            const roiCatData = {
                labels: Object.keys(roi.byCategory),
                datasets: [{
                    data: Object.values(roi.byCategory),
                    backgroundColor: [themeColors.mint, themeColors.purple],
                }]
            };
            const ctxRoi = document.getElementById('roiCategoryChart').getContext('2d');
            chartInstances.roiCategory = new Chart(ctxRoi, {
                type: 'doughnut',
                data: roiCatData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: $${c.raw.toLocaleString()}` } }
                    }
                }
            });
        }
        
        function initResourceHourChart(data) {
            const { investment } = data;
            const labels = Object.keys(investment.byCategory);
            const values = Object.values(investment.byCategory);

            const donutData = {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: [themeColors.blue, themeColors.mint, themeColors.purple],
                }]
            };
            const ctxDonut = document.getElementById('resourceAllocationChartHours').getContext('2d');
            chartInstances.resourceAllocationHours = new Chart(ctxDonut, {
                type: 'doughnut',
                data: donutData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: ${c.raw.toLocaleString()} hrs` } }
                    }
                }
            });
        }

        function initEfficiencyChart() {
            if (activeView === 'hours') {
                if (chartInstances.efficiency) chartInstances.efficiency.destroy();
                return; // Don't draw this chart in hours view
            }
            
            const data = {
                datasets: fullData.projects
                    .filter(p => p.category === 'Quick Win' || p.category === 'Strategic Value')
                    .map((p, i) => {
                        const { investment, roi } = getProjectChartData(p);
                        return {
                            label: p.name,
                            data: [{ x: investment, y: roi, r: 15 }],
                            backgroundColor: [themeColors.blue, themeColors.mint, themeColors.purple, themeColors.yellow][i % 4]
                        };
                    })
            };

            const ctx = document.getElementById('efficiencyChart').getContext('2d');
            chartInstances.efficiency = new Chart(ctx, {
                type: 'bubble',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(c) {
                                    return `${c.dataset.label}: ($${c.raw.x.toLocaleString()} Cost, $${c.raw.y.toLocaleString()} ROI)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Investment' },
                            ticks: { callback: (val) => `$${val / 1000}k` }
                        },
                        y: {
                            title: { display: true, text: 'Annual ROI' },
                            ticks: { callback: (val) => `$${val / 1000000}M` }
                        }
                    }
                }
            });
        }

        function initInvestmentCharts(data) {
            const { investment } = data;
            const labels = Object.keys(investment.byCategory);
            const values = Object.values(investment.byCategory);
            
            const format = (val) => activeView === 'hours' ? `${val.toLocaleString()} hrs` : `$${val.toLocaleString()}`;

            const donutData = {
                labels: labels,
                datasets: [{
                    data: values,
                    backgroundColor: [themeColors.blue, themeColors.mint, themeColors.purple],
                }]
            };
            const ctxDonut = document.getElementById('investmentDonutChart').getContext('2d');
            chartInstances.investmentDonut = new Chart(ctxDonut, {
                type: 'doughnut',
                data: donutData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: { callbacks: { label: (c) => `${c.label}: ${format(c.raw)}` } }
                    }
                }
            });

            const barData = {
                labels: Object.keys(investment.byProject),
                datasets: [{
                    label: activeView === 'hours' ? 'Resource Hours' : 'Investment',
                    data: Object.values(investment.byProject),
                    backgroundColor: [
                        themeColors.blue, themeColors.blue, themeColors.blue, themeColors.blue,
                        themeColors.mint, themeColors.mint, themeColors.mint,
                        themeColors.purple, themeColors.purple
                    ],
                }]
            };
            const ctxBar = document.getElementById('investmentBarChart').getContext('2d');
            chartInstances.investmentBar = new Chart(ctxBar, {
                type: 'bar',
                data: barData,
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: { callback: (val) => activeView === 'hours' ? `${val} hrs` : `$${val / 1000}k` }
                        }
                    }
                }
            });
        }

        function initRoiChart(data) {
            const { roi } = data;
            const roiProjects = fullData.projects.filter(p => p.roiMin > 0);
            
            const barData = {
                labels: roiProjects.map(p => p.name),
                datasets: [{
                    label: 'Min. Annual ROI',
                    data: roiProjects.map(p => p.roiMin),
                    backgroundColor: [themeColors.blue, themeColors.mint, themeColors.purple, themeColors.yellow, themeColors.blue],
                }]
            };
            const ctxBar = document.getElementById('roiBarChart').getContext('2d');
            chartInstances.roiBar = new Chart(ctxBar, {
                type: 'bar',
                data: barData,
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: { callback: (val) => `$${val / 1000000}M` }
                        }
                    }
                }
            });
        }
        
        function populateDetailsTab() {
            const container = document.getElementById('detailsView');
            container.innerHTML = ''; // Clear old content
            
            const { investment } = getChartData(activeView); 
            const format = (val) => activeView === 'hours' ? `${val.toLocaleString()} hrs` : `$${val.toLocaleString()}`;

            fullData.projects.forEach(project => {
                const investmentValue = investment.byProject[project.name];
                
                const card = `
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <div class="flex flex-col md:flex-row justify-between md:items-center mb-2">
                            <h3 class="text-xl font-bold text-theme-blue">${project.name}</h3>
                            <span class="text-sm font-medium ${project.category === 'AI Foundation' ? 'bg-blue-100 text-blue-800' : project.category === 'Quick Win' ? 'bg-green-100 text-green-800' : 'bg-purple-100 text-purple-800'} py-1 px-3 rounded-full mt-2 md:mt-0">
                                ${project.category}
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">${project.description}</p>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-center">
                            <div>
                                <div class="text-sm font-medium text-gray-500 uppercase">${activeView === 'hours' ? 'Resource Effort' : 'Investment'}</div>
                                <div class="text-lg font-bold text-gray-900">${format(investmentValue)}</div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-500 uppercase">Timeline</div>
                                <div class="text-lg font-bold text-gray-900">${project.timeline}</div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-500 uppercase">Min. Annual ROI</div>
                                <div class="text-lg font-bold ${project.roiMin > 0 ? 'text-theme-mint' : 'text-gray-500'}">
                                    ${project.roiMin > 0 ? `$${(project.roiMin / 1000000).toFixed(2)}M` : 'N/A'}
                                </div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-500 uppercase">Metrics</div>
                                <div class="text-sm text-gray-700">${project.metrics.join(', ')}</div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // --- NEW BUDGET TAB LOGIC ---
        
        function initBudgetTab() {
            const toggles = document.querySelectorAll('.budget-toggle');
            toggles.forEach(toggle => {
                toggle.addEventListener('change', updateBudgetData);
            });
            updateBudgetData(); // Initial load
        }

        function formatCurrency(num) {
            // THIS IS THE FIX: New logic to show 1 decimal for < $10k
            if (num === 0) return '$0';
            if (Math.abs(num) >= 1000000) {
                return `$${(num / 1000000).toFixed(1)}M`; // $1.5M
            }
            if (Math.abs(num) >= 10000) { // $10,000 and up
                return `$${(num / 1000).toFixed(0)}k`; // $10k, $31k
            }
            if (Math.abs(num) >= 1000) { // $1,000 to $9,999
                return `$${(num / 1000).toFixed(1)}k`; // $1.5k, $4.2k
            }
            return `$${num.toLocaleString()}`; // $500
        }
        
        function updateBudgetData() {
            const body = document.getElementById('budgetTableBody');
            const footer = document.getElementById('budgetTableFooter');
            if (!body || !footer) return; // Failsafe
            
            body.innerHTML = ''; // Clear table body
            footer.innerHTML = ''; 

            const activeProjects = new Set();
            document.querySelectorAll('.budget-toggle:checked').forEach(toggle => {
                activeProjects.add(toggle.getAttribute('data-project'));
            });

            let monthlyTotals = new Array(14).fill(0);
            let total2025 = 0;
            let total2026 = 0;
            
            fullData.projects.forEach(project => {
                const budgetData = fullData.capitalBudget[project.name];
                const tooltipData = fullData.capitalBudgetTooltips[project.name]; // THIS IS THE FIX
                if (!budgetData) return;

                const row = document.createElement('tr');
                const isActive = activeProjects.has(project.name);
                
                let rowTotal2025 = 0;
                let rowTotal2026 = 0;
                let rowHtml = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${isActive ? 'text-gray-900' : 'text-gray-400'}">${project.name}</td>`;
                
                budgetData.forEach((monthCost, i) => {
                    const cost = isActive ? monthCost : 0;
                    // THIS IS THE FIX: Add tooltip text
                    const tooltipText = (tooltipData && tooltipData[i] && cost > 0) ? tooltipData[i] : (cost === 0 ? 'No cost this month' : '');
                    rowHtml += `<td title="${tooltipText}" class="px-6 py-4 whitespace-nowrap text-sm text-right ${isActive && cost > 0 ? 'text-gray-700' : 'text-gray-400'}">${formatCurrency(cost)}</td>`;
                    monthlyTotals[i] += cost;
                    
                    if (i < 2) { // Nov '25, Dec '25
                        rowTotal2025 += cost;
                    } else { // Jan '26 - Dec '26
                        rowTotal2026 += cost;
                    }

                    // THIS IS THE FIX: Add 2025 Total column
                    if (i === 1) {
                        rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-semibold ${isActive ? 'text-gray-800' : 'text-gray-400'} bg-gray-50" title="Total for 2025">${formatCurrency(rowTotal2025)}</td>`;
                    }
                });
                
                // THIS IS THE FIX: Add 2026 Total column
                rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-semibold ${isActive ? 'text-gray-800' : 'text-gray-400'} bg-gray-50" title="Total for 2026">${formatCurrency(rowTotal2026)}</td>`;
                
                // THIS IS THE FIX: Add Grand Total column
                const grandTotal = rowTotal2025 + rowTotal2026;
                rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold ${isActive ? 'text-gray-900' : 'text-gray-400'} bg-gray-100" title="Grand Total for ${project.name}">${formatCurrency(grandTotal)}</td>`;
                row.innerHTML = rowHtml;
                body.appendChild(row);
            });
            
            // Add footer row
            let footerHtml = `<td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">Total Monthly Need</td>`;
            monthlyTotals.forEach((total, i) => {
                footerHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-theme-purple" title="Total for this month">${formatCurrency(total)}</td>`;
                if (i < 2) { // Nov '25, Dec '25
                    total2025 += total;
                } else { // Jan '26 - Dec '26
                    total2026 += total;
                }
                
                // THIS IS THE FIX: Add 2025 Total footer cell
                if (i === 1) {
                    footerHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-theme-purple bg-gray-200" title="Total for 2025">${formatCurrency(total2025)}</td>`;
                }
            });
            
            // THIS IS THE FIX: Add 2026 Total footer cell
            footerHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-theme-purple bg-gray-200" title="Total for 2026">${formatCurrency(total2026)}</td>`;
            
            // THIS IS THE FIX: Add Grand Total footer cell
            footerHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-theme-purple bg-gray-200" title="Grand Total">${formatCurrency(total2025 + total2026)}</td>`;
            
            const footerRow = document.createElement('tr'); 
            footerRow.innerHTML = footerHtml;
            footer.appendChild(footerRow); 

            // Update KPI Cards
            document.getElementById('budget2025').textContent = formatCurrency(total2025);
            document.getElementById('budget2026').textContent = formatCurrency(total2026);
        }

    </script>

</body>
</html>